var httpProxy = require('http-proxy'),
    Cluster = require('cluster2'),
    http = require('http');

var proxy = httpProxy.createServer(function (req, res, proxy) {
    var buffer = httpProxy.buffer(req);
    var delay = Math.floor((Math.random() * (1000 - 500)) + 500);
    setTimeout(function () {
        console.log(delay);
        proxy.proxyRequest(req, res, {
            host: 'svcs.ebay.com',
            port: 80,
            buffer: buffer
        });
    }, delay);
});

var c = new Cluster({
    port: 8000,
    cluster: true,
    monPort: 8001
});

c.listen(function (cb) {
    cb(proxy);
});

